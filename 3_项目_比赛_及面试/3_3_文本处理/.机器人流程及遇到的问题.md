# :running:智能客服流程:running:

0、转人工跳转逻辑

页面直接进去，点跳转<br> 10%
触碰关键词跳转（转人工、冻结等）<br> 5%
回答正确跳转<br> 6%
回答错误跳转<br> 12%

1、项目背景：

1.1 7*24小时给顾客提供咨询服务；<br>
1.2 在大促期间顾客咨询量比较大，可以给客服工作量进行分流；当然最终的目的就是能够提高用户体验。<br>
这里用户体验永远是放在第一位的

2、项目目标：

工程层面：TPS 800、响应时间500ms以内<br>
业务层面：转人工率30%
算法层面：准确率88%上下浮动4%，召回率：93%

3、项目开始:

其实我们金融这边之前是没有独立的客服机器人，所以这个项目也是一个从无到有的过程，前期就花了很多时间进行竞品分析、技术调研

4、整个项目流程：

用户->*信（消息转发层）->SA\*CIF（NE\*TY长连接）->智能客服业务系统（服务接口）->机器人restful api <br>

首先我们会提供一个restful api接口：接收报文（报文包括用户的问题，什么端发过来的，户头号等；会员信息通过户头号去ES查询的）<br>
参数解析：主要提取问题<br>
标准化编码：utf-8编码<br>
字符纯化：去除杂质<br>
分词<br>
人工场景判断：这里有两种情况，情况一：用户直接输入人工或找客服；情况二：hit到人工字典，比如用户说账户被盗了、\**宝转出超时未到账、
\**付注销、结清证明怎么开等等<br>
意图识别：这里的意图识别主要有三个模块，通用型、任务型、专业型<br>
通用型：主要是闲聊，比如问候语，还有生成式的对话(Seq2Seq)<br>
任务型：首先进行任务的意图识别，比如是查询余额还是查询天气等；然后我们会做一个实体识别和槽位填充，比如用户想查天气问今天天气怎么样，
我们会识别时间实体，还有地点实体如果用户没有直接提到我们会用定位地址进行查询<br>
专业型：专业型这个模块是一个大头，因为大部分用户进来就是问一些金融产品问题的。<br>
接专业型-文本纠错：主要用了基于隐马的PinYin<br>
关键词提取：TFIDF、TextRank和Word2Vec算概率进行排序融合，然后融合后的结果和词性标注进行归并融合<br>
句式分析(optional 没做)：看下这个句子是疑问句，否定句或双重否定句等<br>
场景意图识别：用户想要问哪个金融场景的问题，第一版机器人有12类、第二版20类，主要用FastText和CNN的模型融合<br>
相似问匹配：先判断字符长度，如果长度大于60则直接用编辑距离匹配（速度快），如果小于60再判断下是否有监督，
如果是无监督我们用到词向量+WMD和关键词+Jaccard融合，得到融合结果判断如果相似度大于0.6则根据相似度排序取top1问题对应的答案返回，
如果0.4-0.6之间则根据相似度排序返回top5相似问，如果小于0.4则返回到闲聊场景

---

## :running:该项目中遇到的问题及优化方案:running:

问题1：知识库扩充以后6000->12000，响应性能变慢（相似问匹配的效率下降）

有些类别比如\**贷，从1000增加到3000，<br>
1、从算法层面，对类别进行的细分，比如\**贷中再细分为\**贷申请、\**贷还款等<br>
2、从工程层面，加入的ES模块，通过倒排索引和tfidf，搜索效率和准确率都得到了提升；<br>
ES还有个作用就是单独做一个知识库系统，方便业务直接把知识库问答导入

问题2：TPS下降，服务进程池资源耗尽问题？<br>
ES算法模块问题(进程分配，解决方案，加个判断逻辑如果候选答案小于200个则用一个进程处理，以此类推总共8个进程) + 抛错以后代码里面进程没有释放

问题3：催收机器人里一句话对应多标签问题<br>
86% -> 94%

问题4：智能客服界面引导的东西没有，这个需要和业务商量调整<br>

问题5：催收机器人中意图识别开发中，用pytorch实现胶囊网络<br>
GRU里面的权重一定要像keras那样初始化（ih->glorot_uniform,hh->orthogonal,bias->zero）<br>
初始化后acc会一直上升到0.98；如果用默认初始化则acc一直在0.5跳动<br>
优化器有时候也需要改

# :running:催收机器人流程:running:
